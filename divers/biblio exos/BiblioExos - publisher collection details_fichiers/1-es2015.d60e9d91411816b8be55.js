(window.webpackJsonp=window.webpackJsonp||[]).push([[1,97],{"/JnO":function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return c}));var o=s("oAFm"),n=s("a82P");class r{constructor(e){this.code=e.code,this.created_date=o.a.serverTimestampToDate(e.created_date),this.studentId=e.student}}class c{constructor(e){this.codes={},this.parents={};for(let t of e.codes)this.codes[t.student]=t.code;for(let t of e.parents){let e=this.parents[t.student.id];e||(e=[],this.parents[t.student.id]=e),e.push(new n.b(t.parent))}}}},"4Tnb":function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var o=s("lJxs"),n=s("/JnO"),r=s("soBk"),c=s("g3ua"),i=s("dLnV"),a=s("xuHj"),l=s("fXoL");const u="/gradebook/students/connectioncodes/schoolclass/";class d{constructor(e){this._restClient=e}getParentsChildren(){return this._restClient.get("/gradebook/parent/students").pipe(Object(o.a)(this.mapStudents))}getParentsSingleChildren(e){return this._restClient.get("/gradebook/parent/students").pipe(Object(o.a)(t=>this.mapStudentsUserCollection(t,e)))}getParentsForChilder(e){let t=`/gradebook/student/${e}/parents`;return this._restClient.get(t).pipe(Object(o.a)(this.mapParents))}getChildParents(e,t){let s=`/gradebook/parents/schoolclass/${e}/student/${t}`;return this._restClient.get(s).pipe(Object(o.a)(this.mapParents))}removeParent(e,t,s){let r=`/gradebook/parents/schoolclass/${e}/student/${s}/parent/${t}`;return this._restClient.post(r).pipe(Object(o.a)(e=>e?new n.a(e):null))}getParentCodes(e){return this._restClient.get(u+e).pipe(Object(o.a)(e=>new n.b(e)))}generateParentCodes(e,t){let s={};return t&&(s.students_ids=t.map(e=>e.id)),this._restClient.post(u+e,s).pipe(Object(o.a)(this.mapParentCodes))}deleteParentCodes(e,t){let s={};return t&&(s.students_ids=t.map(e=>e.id)),this._restClient.post(u+e+"/delete",s)}getChildInfo(e){return this._restClient.get("/gradebook/students/connectioncodes/code/"+e).pipe(Object(o.a)(e=>new c.b(e)))}connectChild(e){return this._restClient.post("/gradebook/students/connectioncodes/code/"+e)}mapStudents(e){return e.map(e=>new i.User(e.student))}mapParents(e){return e.map(e=>new i.User(e.parent))}mapParentCodes(e){let t={};for(let s of e)t[s.student]=s.code;return t}mapStudentsUserCollection(e,t){return e.map(e=>new a.a(e.student)).find(e=>e.id===t)}}d.\u0275fac=function(e){return new(e||d)(l.qc(r.A))},d.\u0275prov=l.cc({token:d,factory:d.\u0275fac})},"5eAg":function(e,t,s){"use strict";var o,n;s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return n})),function(e){e.HANDSHAKE="HANDSHAKE",e.REQUEST_USER_DATA="REQUEST_USER_DATA",e.USER_DATA="USER_DATA",e.REQUEST_COLLECTIONS_DATA="REQUEST_COLLECTIONS_DATA",e.REQUEST_COLLECTION_ID="REQUEST_COLLECTION_ID",e.REQUEST_COLLECTION_DATA="REQUEST_COLLECTION_DATA",e.REQUEST_COLLECTION_DATA_WITH_FLAGS="REQUEST_COLLECTION_DATA_WITH_FLAGS",e.REQUEST_COLLECTION_DATA_BY_URL="REQUEST_COLLECTION_DATA_BY_URL",e.REQUEST_COLLECTION_EXTERNAL_RESOURCES="REQUEST_COLLECTION_EXTERNAL_RESOURCES",e.REQUEST_COLLECTION_LESSONS_PAGINATED_RESULTS_DATA="REQUEST_COLLECTION_LESSONS_PAGINATED_RESULTS_DATA",e.REQUEST_COLLECTION_CUSTOM_TOC_FIRST_VISIT_DATE_DATA="REQUEST_COLLECTION_CUSTOM_TOC_FIRST_VISIT_DATE_DATA",e.POST_COLLECTION_CUSTOM_TOC_FIRST_VISIT_DATE_DATA="POST_COLLECTION_CUSTOM_TOC_FIRST_VISIT_DATE_DATA",e.REQUEST_COLLECTION_CUSTOM_TOC_AND_ANY_LESSON_LAST_VISITS_DATES_DATA="REQUEST_COLLECTION_CUSTOM_TOC_AND_ANY_LESSON_LAST_VISITS_DATES_DATA",e.POST_COLLECTION_CUSTOM_TOC_LAST_VISIT_DATE_DATA="POST_COLLECTION_CUSTOM_TOC_LAST_VISIT_DATE_DATA",e.REQUEST_COLLECTION_CUSTOM_TOC_STATE_DATA="REQUEST_COLLECTION_CUSTOM_TOC_STATE_DATA",e.POST_COLLECTION_CUSTOM_TOC_STATE_DATA="POST_COLLECTION_CUSTOM_TOC_STATE_DATA",e.REQUEST_COLLECTION_CODE_ACTION_AND_MARKET="REQUEST_COLLECTION_CODE_ACTION_AND_MARKET",e.REQUEST_FIRESTORE_CUSTOM_TOKEN="REQUEST_FIRESTORE_CUSTOM_TOKEN",e.FIRESTORE_CUSTOM_TOKEN="FIRESTORE_CUSTOM_TOKEN",e.COLLECTION_DATA_BY_URL="COLLECTION_DATA_BY_URL",e.COLLECTIONS_DATA="COLLECTIONS_DATA",e.COLLECTION_DATA="COLLECTION_DATA",e.COLLECTION_DATA_WITH_FLAGS="COLLECTION_DATA_WITH_FLAGS",e.COLLECTION_EXTERNAL_RESOURCES="COLLECTION_EXTERNAL_RESOURCES",e.COLLECTION_ID="COLLECTION_ID",e.COLLECTION_LESSONS_PAGINATED_RESULTS_DATA="COLLECTION_LESSONS_PAGINATED_RESULTS_DATA",e.COLLECTION_CUSTOM_TOC_FIRST_VISIT_DATE_DATA="COLLECTION_CUSTOM_TOC_FIRST_VISIT_DATE_DATA",e.COLLECTION_CUSTOM_TOC_AND_ANY_LESSON_LAST_VISITS_DATES_DATA="COLLECTION_CUSTOM_TOC_AND_ANY_LESSON_LAST_VISITS_DATES_DATA",e.COLLECTION_CUSTOM_TOC_STATE_DATA="COLLECTION_CUSTOM_TOC_STATE_DATA",e.COLLECTION_CODE_ACTION_AND_MARKET="COLLECTION_CODE_ACTION_AND_MARKET",e.REQUEST_CROSS_RESOURCE="REQUEST_CROSS_RESOURCE",e.REQUEST_LESSON="REQUEST_LESSON",e.WHITEBOARD_WHO_EDIT_DATA="WHO_EDIT_DATA",e.REQUEST_LOGIN_VIEW="REQUEST_LOGIN_VIEW"}(o||(o={})),function(e){e.ADD_WHITEBOARD_ACCESS="WHO_EDIT"}(n||(n={}))},IAFm:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s("5eAg"),n=s("fXoL");class r{constructor(){}onHandshake(e,t){t.next({type:o.b.HANDSHAKE,isAuthenticated:!!e&&e.isAuthenticated})}}r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=n.cc({token:r,factory:r.\u0275fac})},VCwu:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var o=s("LRne"),n=s("5+tZ"),r=s("lJxs"),c=s("JIr8"),i=s("dLnV"),a=s("soBk"),l=s("fXoL");class u{constructor(e,t){this._restClient=e,this._authUserService=t}getCollection(e,t,s){return this._authUserService.get().pipe(Object(n.b)(n=>n.isAuthenticated?this._restClient.get(`/library/collections/${t}${s?"/search/"+s:""}/${e}`).pipe(Object(r.a)(this.mapCollection),Object(c.a)(e=>Object(o.a)(null))):this._restClient.getPublic(`/library/collections/${t}${s?"/search/"+s:""}/${e}`).pipe(Object(r.a)(this.mapCollection),Object(c.a)(e=>Object(o.a)(null)))))}getCollectionById(e){return this._restClient.getPublic(`/library/collections/${e}/id`).pipe(Object(r.a)(this.mapCollection),Object(c.a)(e=>Object(o.a)(null)))}getCollectionDetails(e,t){let s;if(window.api_response&&window.api_response.url===t){const e=window.api_response;window.api_response=void 0,s=Object(o.a)(this.mapCollectionDetails(e))}else this._authUserService.get().subscribe(n=>{s=n.isAuthenticated?this._restClient.get(`/library/collections/${t}/details/${e}`).pipe(Object(r.a)(this.mapCollectionDetails),Object(c.a)(e=>Object(o.a)(null))):this._restClient.getPublic(`/library/collections/${t}/details/${e}`).pipe(Object(r.a)(this.mapCollectionDetails),Object(c.a)(e=>Object(o.a)(null)))});return s}mapCollection(e){return e?new i.Collection(e):null}mapCollectionDetails(e){return e?new i.CollectionDetails(e):e}}u.\u0275fac=function(e){return new(e||u)(l.qc(a.A),l.qc(a.f))},u.\u0275prov=l.cc({token:u,factory:u.\u0275fac})},bHR5:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var o=s("lJxs"),n=s("HDdC"),r=s("g3ua"),c=s("aJOX"),i=s("xuHj"),a=s("fXoL");class l{constructor(e){this._restClient=e}getSchoolClasses(e){const t=e?"/school/classes/semester/"+e:"/school/classes";return this._restClient.get(t).pipe(Object(o.a)(this.mapSchoolClasses))}getCurrentSchoolClasses(){return this._restClient.get("/school/classes/current_semester").pipe(Object(o.a)(this.mapSchoolClasses))}getClass(e,t){const s=t?"/school/classes/"+e+"/semester/"+t:"/school/classes/"+e;return this._restClient.get(s).pipe(Object(o.a)(this.mapSchoolClass))}getClassStudents(e){return n.a.create(t=>{this.getStudentsInBatches(e,t)})}getSchoolClassTeachers(e){return this._restClient.get("/school/classes/"+e+"/teachers").pipe(Object(o.a)(this.matSchoolTeachers))}getSchoolClassRandomAccessCode(e){return this._restClient.post("/school/classes/access_code",{class_id:e})}getSchoolClassCoursesWithAccessUsers(e){return this._restClient.get("/school/classes/"+e+"/collection/access_users").pipe(Object(o.a)(this.mapCollectionWithAccessUsers))}mapCollectionWithAccessUsers(e){return e.map(e=>new i.d(e))}addSchoolClass(e,t){const s=t?"/school/classes/semester/"+t:"/school/classes";return this._restClient.post(s,{name:e}).pipe(Object(o.a)(this.mapSchoolClass))}updateSchoolClass(e,t){const s=t?"/school/classes/"+e.id+"/semester/"+t:"/school/classes/"+e.id,n=e.accessCode&&e.accessCode.length>0?e.accessCode:null,r={name:e.name,assign_code:n,grade_scale_id:e.gradeScaleId?e.gradeScaleId:void 0,external_id:e.external_id};return this._restClient.put(s,r).pipe(Object(o.a)(this.mapSchoolClass))}deleteSchoolClass(e,t){return t?this._restClient.delete("/school/classes/"+e+"/semester/"+t):this._restClient.delete("/school/classes/"+e)}assignStudentsToClass(e,t){const s=t.map(e=>e.id);return this._restClient.put("/school/classes/"+e+"/students",{students:s}).pipe(Object(o.a)(e=>e.assigned_count))}unassignStudentsFromClass(e,t){const s=t.map(e=>e.id);return this._restClient.post("/school/classes/"+e+"/students",{students:s}).pipe(Object(o.a)(e=>e.unassigned_count))}assignTeachersToClass(e,t){const s=t.map(e=>e.id);return this._restClient.put("/school/classes/"+e+"/teachers",{teachers:s}).pipe(Object(o.a)(e=>e.assigned_count))}unassignTeachersFromClass(e,t){const s=t.map(e=>e.id);return this._restClient.post("/school/classes/"+e+"/teachers",{teachers:s}).pipe(Object(o.a)(e=>e.unassigned_count))}getStudentsInBatches(e,t,s=null){this._restClient.get("/school/classes/"+e+"/students"+(s?"?cursor="+s:"")).subscribe(s=>{t.next(s.students.map(e=>new r.b(e))),s.more_count>0&&s.cursor?this.getStudentsInBatches(e,t,s.cursor):t.complete()})}mapSchoolClass(e){const t=e;return new r.a(t)}mapSchoolClasses(e){return e.map(e=>new r.a(e)).sort((e,t)=>e.name.localeCompare(t.name))}matSchoolTeachers(e){return e.map(e=>new r.c(e))}}l.\u0275fac=function(e){return new(e||l)(a.qc(c.c))},l.\u0275prov=a.cc({token:l,factory:l.\u0275fac})},g4uV:function(e,t,s){"use strict";s.d(t,"a",(function(){return T}));var o=s("cp0P"),n=s("HDdC"),r=s("5eAg"),c=s("4Tnb"),i=s("5e9n"),a=s("lJxs"),l=s("SxV6"),u=s("w6sX"),d=s("bHR5"),_=s("Ou6q"),C=s("fXoL");class T{constructor(e,t,s,o,n){this._mySchoolParentService=e,this._yearDefinition=t,this._schoolGradebook=s,this._classService=o,this._firestoreTokenService=n,this.subscriptions=[]}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}getUserData(e,t){const s={id:e.id,type:r.b.USER_DATA,user_is_authenticated:e.isAuthenticated,role:this.getUserRole(e),school:e.school.id,children:[],teacher_students:[]};Object(o.a)(this.getChildren(e),this.getSchoolClassStudents(e)).subscribe(([e,o])=>{s.children=e,s.teacher_students=o,t.next(s)})}getUserRole(e){return e.isSchoolAdmin()?"school_admin":e.isSchoolTeacher()?"teacher":e.isSchoolStudent()?"student":e.isParent()?"parent":"student"}getChildren(e){return n.a.create(t=>{e.isParent()?this._mySchoolParentService.getParentsChildren().subscribe(e=>{const s=e.map(e=>e.id);t.next(s),t.complete()},()=>{t.next([]),t.complete()}):(t.next([]),t.complete())})}getSchoolClassStudents(e){return n.a.create(t=>{e.isSchoolTeacher()?this._yearDefinition.getSchoolSemesters().subscribe(s=>{const n=i.a.getSemesterByIdOrCurrent(s),r=n?n.id:null;this.getClassClassIds(r).subscribe(s=>{const n=[];for(const t of s){const s=this.getMappedClassStudents(t,Number(e.school.id));n.push(s)}Object(o.a)(n).subscribe(e=>{t.next([].concat(...e)),t.complete()},()=>{t.next([]),t.complete()})})},()=>{t.next([]),t.complete()}):(t.next([]),t.complete())})}getClassClassIds(e){return n.a.create(t=>{Object(o.a)(this.getSubjects(e),this._schoolGradebook.getFormTutorClasses(e)).subscribe(([e,s])=>{const o=s.map(e=>e.id);e.forEach(e=>{const t=e.classId;-1===o.indexOf(t)&&o.push(t)}),t.next(o),t.complete()})})}getSubjects(e){return this._schoolGradebook.getTeacherSubjects(e).pipe(Object(a.a)(e=>this.filterUniqueSubjects(e)))}filterUniqueSubjects(e){const t=[];return e.forEach(e=>{0===t.filter(t=>t.classId===e.classId).length&&t.push(e)}),t}getMappedClassStudents(e,t){return this._classService.getClassStudents(e).pipe(Object(a.a)(s=>s.map(s=>({id:s.id,class:e,school:t}))))}getUserCustomToken(e,t){this.subscriptions.push(this._firestoreTokenService.getToken().pipe(Object(l.a)()).subscribe(e=>{const s={data:{token:e},type:r.b.FIRESTORE_CUSTOM_TOKEN};t.next(s)}))}}T.\u0275fac=function(e){return new(e||T)(C.qc(c.a),C.qc(i.a),C.qc(u.a),C.qc(d.a),C.qc(_.a))},T.\u0275prov=C.cc({token:T,factory:T.\u0275fac})},qfWi:function(e,t,s){"use strict";s.d(t,"a",(function(){return O})),s.d(t,"b",(function(){return S}));var o=s("dLnV"),n=s("soBk"),r=s("HkNm"),c=s("5eAg"),i=s("VCwu"),a=s("cp0P"),l=s("z6cu"),u=s("LRne"),d=s("mCNh"),_=s("JIr8"),C=s("lJxs"),T=s("5+tZ"),p=s("JiHW"),h=s("fXoL");o.CollectionResourceType.RESOURCE_TYPE;var O;!function(e){e.GET="GET",e.POST="POST"}(O||(O={}));class S{constructor(e,t,s,o){this._restClient=e,this._urlBuilder=t,this._collectionService=s,this._publisherCollectionService=o,this.customTOCRequestLocked=!1}getCollectionsData(e,t){this._collectionService.getCollections().subscribe(s=>{const o=[];s.forEach(e=>{e.eCommerce.isShared()||o.push({id:e.id,mAuthorId:e.originalID,title:e.title,score:e.score,errors:e.errors,time:e.time,userId:t.id,userName:t.username})}),e.next({type:c.b.COLLECTIONS_DATA,data:o})})}getCollectionId(e,t){const s={collectionId:e};t.next({type:c.b.COLLECTION_ID,data:s})}getPublicCollectionData(e,t,s){Object(a.a)([this._publisherCollectionService.getCollectionDetails(t,e),this._publisherCollectionService.getCollection(t,e)]).subscribe(([o,n])=>{const r={id:o.id,mAuthorId:o.originalID,collectionURL:e,publisherURL:t,sampleLessons:o.sampleLessons.map(e=>({id:e.id,icon:e.iconUrl,title:e.title,description:e.description,type:e.type})),sampleLessonsDescription:o.sampleLessonsDescription,screenShotsDescription:o.screenShotsDescription,screenShots:o.screenShots.map(e=>e.url),lessons:n.resources.map(e=>({name:e.name,type:e.type.getType(),chapter:e.parentChapter,icon:e.icon,description:e.description,definedId:e.definedId,errors:e.errors,time:e.time,score:e.score})),chapters:n.chapters.map(e=>({id:e.id,parent:e.parentChapter,title:e.title,description:e.description}))};s.next({type:c.b.COLLECTION_DATA_BY_URL,data:r})})}getCollectionData(e,t,s){this._collectionService.getCollectionScore(s.id,e,!1,!1,!0).subscribe(e=>{if(e.eCommerce.isShared())return;const o={id:e.id,mAuthorId:e.originalID,lessons:e.resources.map(e=>({belongsTo:e.belongsTo,resourceId:e.resourceId,id:e.id,name:e.name,type:e.type.getType(),chapter:e.parentChapter,icon:e.icon,description:e.description,definedId:e.definedId,errors:e.errors,extended_metadata:e.extended_metadata,tags:e.tags,time:e.time,score:e.score})),chapters:e.chapters.map(e=>({id:e.id,parent:e.parentChapter,title:e.title,description:e.description})),userId:s.id,userName:s.username,iconUrl:e.iconUrl};t.next({type:c.b.COLLECTION_DATA,data:o})})}getCollectionDataWithFlags(e,t,s){Object(a.a)([this._collectionService.getCollectionScore(s.id,e,!1,!0,!0),this.getCollectionAdaptiveStatus(e),this.getAdaptiveCollectionUnlockedLessons(e)]).subscribe(([e,o,n])=>{if(e.eCommerce.isShared())return;const r=this.getDataToSend(e,s,o);this.mapIsUnlockedParameter(r,n),t.next({type:c.b.COLLECTION_DATA_WITH_FLAGS,data:r})})}getDataToSend(e,t,s){return{id:e.id,mAuthorId:e.originalID,lessons:this.mapLessonsFromCollectionData(e),chapters:this.mapChaptersFromCollectionData(e),userId:t.id,userName:t.username,isAdaptive:s.is_adaptive,iconUrl:e.iconUrl}}mapLessonsFromCollectionData(e){return e.resources.map(e=>({id:e.id,name:e.name,type:e.type.getType(),chapter:e.parentChapter,icon:e.icon,description:e.description,definedId:e.definedId,errors:e.errors,extendedMetadata:e.extended_metadata,tags:e.tags,time:e.time,score:e.score,isUnlocked:null}))}mapChaptersFromCollectionData(e){return e.chapters.map(e=>({id:e.id,parent:e.parentChapter,title:e.title,description:e.description}))}mapIsUnlockedParameter(e,t){e.lessons.forEach(e=>{e.isUnlocked=t?-1!==(null==t?void 0:t.unlocked_resources.indexOf(e.id)):null})}getCollectionAdaptiveStatus(e,t=!1){const s=this._urlBuilder.format("/course/{:course_id}/adaptive",{course_id:e});return this.getCollectionStatusData(s,t)}getCollectionStatusData(e,t){return this._restClient.get(e).pipe(Object(_.a)(e=>t?Object(l.a)(e):Object(u.a)(null)))}getAdaptiveCollectionUnlockedLessons(e,t=!1){const s=this._urlBuilder.format("/course/{:course_id}/adaptive_course_lessons_status",{course_id:e});return this.getAdaptiveCollectionUnlockedLessonsData(s,t)}getAdaptiveCollectionUnlockedLessonsData(e,t){return this._restClient.get(e).pipe(Object(_.a)(e=>t?Object(l.a)(e):Object(u.a)(null)))}getCollectionExternalResources(e,t){this._collectionService.getExternalResourcesForCustomTOC().subscribe(s=>{const o=s.filter(t=>t.course_id===e),n={courseId:e,externalResources:o[0]?o[0].external_resources:[]};t.next({type:c.b.COLLECTION_EXTERNAL_RESOURCES,data:n})})}mapLessonDetails(e){const t=e;return e?new p.a(t):null}getLessonDetails(e,t=!1){const s=this._urlBuilder.format("/lesson/details/{:lesson_id}",{lesson_id:e});return this._restClient.get(s).pipe(Object(C.a)(e=>this.mapLessonDetails(e)),Object(_.a)(e=>t?Object(l.a)(e):Object(u.a)(null)))}getLessonsDetailsData(e,t){this._collectionService.getCollection(e).pipe(Object(C.a)(e=>e.resources),Object(C.a)(e=>e.map(({id:e})=>this.getLessonDetails(e))),Object(T.b)(e=>Object(a.a)(e).pipe(Object(C.a)(e=>e.map(e=>({lessonID:e.lesson.id,lessonPaginatedResults:e.score.paginatedScore})))))).subscribe(s=>{const o={id:e,lessonsPaginatedResults:s};t.next({type:c.b.COLLECTION_LESSONS_PAGINATED_RESULTS_DATA,data:o})})}requestCollectionCustomTOCData(e,t,s=!1){const o=this._urlBuilder.format("/my_content/collections/{:collection_id}/custom_toc/data",{collection_id:e});return t===O.GET?this._restClient.get(o).pipe(Object(_.a)(e=>s?Object(l.a)(e):Object(u.a)(null))):t===O.POST?this._restClient.post(o).pipe(Object(_.a)(e=>s?Object(l.a)(e):Object(u.a)(null))):void 0}requestCollectionCustomTOCFirstVisitDateData(e,t,s){this.customTOCRequestLocked||(this.customTOCRequestLocked=!0,this.requestCollectionCustomTOCData(e,t).subscribe(t=>{const o={id:e,collectionCustomTOCFirstVisitDate:t.first_visit_date};s.next({type:c.b.COLLECTION_CUSTOM_TOC_FIRST_VISIT_DATE_DATA,data:o}),this.customTOCRequestLocked=!1}))}requestCollectionCustomTOCAndAnyLessonLastVisitsDatesData(e,t,s){this.customTOCRequestLocked||(this.customTOCRequestLocked=!0,this.requestCollectionCustomTOCData(e,t).subscribe(t=>{const o={id:e,collectionCustomTOCLastVisitDate:t.custom_toc_last_visit_date,collectionAnyLessonLastVisitDate:t.any_lesson_last_visit_date};s.next({type:c.b.COLLECTION_CUSTOM_TOC_AND_ANY_LESSON_LAST_VISITS_DATES_DATA,data:o}),this.customTOCRequestLocked=!1}))}requestCollectionCustomTOCState(e,t,s,o=!1){const n=this._urlBuilder.format("/my_content/collections/{:collection_id}/custom_toc/data",{collection_id:e}),r=Object(d.a)(Object(_.a)(e=>o?Object(l.a)(e):Object(u.a)(null)));return s===O.GET?this._restClient.get(n).pipe(r):s===O.POST?this._restClient.post(n,t).pipe(r):void 0}requestCollectionCustomTOCStateData(e,t,s,o){this.requestCollectionCustomTOCState(e,o,t).subscribe(t=>{const o={id:e,collectionCustomTOCState:t.state};s.next({type:c.b.COLLECTION_CUSTOM_TOC_STATE_DATA,data:o})})}requestCollectionCodeActionAndMarket(e,t=!1){const s=this._urlBuilder.format("/my_content/collections/{:collection_id}/custom_toc/data",{collection_id:e}),o=Object(d.a)(Object(_.a)(e=>t?Object(l.a)(e):Object(u.a)(null)));return this._restClient.get(s).pipe(o)}requestCollectionCodeActionAndMarketData(e,t){this.requestCollectionCodeActionAndMarket(e).subscribe(s=>{const o={id:e,collectionCodeAction:s.collection_code_action,collectionMarket:s.collection_market};t.next({type:c.b.COLLECTION_CODE_ACTION_AND_MARKET,data:o})})}crossResource(e,t,s,o,n,r){let c="/deeplinks/resolve/cross_lesson";c+="?lesson_defined_id="+t,c+="&course_resource_id="+e,s&&(c+="&mauthor_course_id="+s),o&&(c+="&page_id="+o),n&&(c+="&lesson_type="+n),c+=r?"&view_type=view_only":"&view_type=view",window.open(c,"_blank")}}S.\u0275fac=function(e){return new(e||S)(h.qc(n.A),h.qc(n.H),h.qc(r.a),h.qc(i.a))},S.\u0275prov=h.cc({token:S,factory:S.\u0275fac})},w6sX:function(e,t,s){"use strict";s.d(t,"a",(function(){return _}));var o=s("lJxs"),n=s("g3ua"),r=s("fpys"),c=s("63hL"),i=s("rGSZ");class a{constructor(e){if(this.columns=[],this.grades=[],this.subject=new r.a(e.subject),this.gradeScale=new i.a(e.grade_scale),this.columns&&(this.columns=e.columns.map(e=>new c.a(e))),this.grades){let t=e.grades.map(e=>new c.c(e));this.grades=t.filter(e=>{const t=this.columns.find(t=>t.id===e.columnId);return t&&(e.column=t),t}).sort((e,t)=>e.createdTime-t.createdTime),this.finalGrade=t.find(e=>{const t=this.columns.find(t=>t.id===e.columnId);return t&&t.type.isFinal})}}}class l{constructor(e){this.studentId=e.student_id,this.grade=new c.c(e.grade)}}var u=s("aJOX"),d=s("fXoL");class _{constructor(e){this._restClient=e}getFormTutorClasses(e=null){const t=e?"/gradebook/formtutor/schoolclasses/semester/"+e:"/gradebook/formtutor/schoolclasses";return this._restClient.get(t).pipe(Object(o.a)(e=>e.map(e=>new n.a(e))))}getStudentClasses(e,t=null){let s=`/gradebook/student/${e}/schoolclasses`;return s=t?`${s}/semester/${t}`:s,this._restClient.get(s).pipe(Object(o.a)(e=>e.map(e=>new n.a(e))))}getStudentSubjects(){return this._restClient.get("/school/subjects/mySubjects").pipe(Object(o.a)(this.mapMySubjects))}mapMySubjects(e){return e?e.map(e=>new r.a(e)).sort((e,t)=>e.name.localeCompare(t.name)):[]}getForumTutorClassSubjects(e){return this._restClient.get("/gradebook/formtutor/schoolclass/"+e+"/subjects").pipe(Object(o.a)(this.mapSubjects))}getStudentGrades(e=null){const t=e?"/gradebook/student/grades/semester/"+e:"/gradebook/student/grades";return this._restClient.get(t).pipe(Object(o.a)(this.mapStudentGrades))}getParentStudentGrades(e,t){const s="/gradebook/student/"+e+"/grades/semester/"+t;return this._restClient.get(s).pipe(Object(o.a)(this.mapStudentGrades))}getTeacherSubjects(e=null){const t=e?"/gradebook/teacher/subjects_list/semester/"+e:"/gradebook/teacher/subjects_list";return this._restClient.get(t).pipe(Object(o.a)(e=>e.map(e=>new r.a(e))))}getTeacherBasicSubjects(){return this._restClient.get("/gradebook/teacher/basic_subjects").pipe(Object(o.a)(e=>e.map(e=>new r.a(e))))}getStudentGradesByFormTutor(e,t){const s=`/gradebook/formtutor/student/${e}/schoolclass/${t}/grades`;return this.getSubjectGrades(s)}getStudentGradesByTeacher(e,t){const s=`/gradebook/teacher/student/${e}/subject/${t}/grades`;return this.getSubjectGrades(s)}getBehaviorGrades(e){const t="/gradebook/behaviour/schoolclass/"+e;return this._restClient.get(t).pipe(Object(o.a)(this.mapClassBehaviorGrades))}setBehaviorGrade(e,t,s){const n=`/gradebook/behaviour/schoolclass/${e.id}/student/${t.id}`;return this._restClient.put(n,s.raw()).pipe(Object(o.a)(this.mapGradebookGrade))}deleteBehaviorGrade(e,t){const s=`/gradebook/behaviour/schoolclass/${e.id}/student/${t.id}`;return this._restClient.delete(s)}getSubjectGrades(e){return this._restClient.get(e).pipe(Object(o.a)(this.mapStudentGrades))}mapSubjects(e){return e.map(e=>new r.a(e))}mapStudentGrades(e){return e.map(e=>new a(e))}mapClassBehaviorGrades(e){return e.students.map(e=>new l(e))}mapGradebookGrade(e){return new c.c(e)}}_.\u0275fac=function(e){return new(e||_)(d.qc(u.c))},_.\u0275prov=d.cc({token:_,factory:_.\u0275fac,providedIn:"root"})}}]);